---
title: "HW1 Week 2"
author: "David Tessier"
date: "9/28/2021"
output: github_document
---
  
```{r}

rm(list = ls())


library(nycflights13)
library(dplyr)


## 1: select all flgiths on Jan. 1st with:
Missing_Dep_Time = filter(flights, is.na(dep_time))

#    all of these selected flights have a missing departure time, but they 
#    also seem to include an NA value for dep_delay, arr_time, and arr_delay as well.
#    This likely indicates that the flight was canceled and never departed at all.

# 2: Currently dep_time and sched_dep_time are convenient to look at, 
#    but hard to compute with because theyâ€™re not really continuous numbers. Convert
#    them to a more convenient representation of number of minutes since midnight.
# Arrange_Dep_Time = arrange(flights, desc(dep_time))

flights_new = select(flights,
                     dep_time,
                     sched_dep_time)

mutate(flights_new,
         dep_hour = dep_time %/% 100,
         dep_minute = dep_time %% 100,
         Dep_Mins_Since_Midnight = dep_minute + (dep_hour*60)
       )
View(flights_new)

# 3: Look at the number of canceled flights per day. Is there a pattern? Is the proportion
#    of canceled flights related to the average delay? Use multiple dyplr operations,
#    concluding with ggplot(aes(x= , y=)) + geom_point()

cancelled_per_day = 
  flights %>%
  mutate(cancelled_flights = (is.na(flights$dep_time)) & (is.na(flights$arr_time))) %>%
  group_by(year, month, day) %>%
  summarise(
    tot_cancelled_flights = sum(cancelled_flights),
    num_of_flights = n()
  )

ggplot(cancelled_per_day) +
  geom_point(aes(x = num_of_flights, y = tot_cancelled_flights))
  

cancelled_and_delays = 
  flights %>%
  mutate(cancelled_flights = (is.na(flights$dep_time)) & (is.na(flights$arr_time))) %>%
  group_by(year, month, day) %>%
  summarise(
    cancelled_proportion = mean(cancelled_flights),
    avg_dep_delay = mean(dep_delay, na.rm = TRUE),
    avg_arr_delay = mean(arr_delay, na.rm = TRUE)
  ) %>%
  ungroup()

ggplot(cancelled_and_delays) +
  geom_point(aes(x = avg_dep_delay, y = cancelled_proportion))
ggplot(cancelled_and_delays) +
  geom_point(aes(x = avg_arr_delay, y = cancelled_proportion))
                    
```